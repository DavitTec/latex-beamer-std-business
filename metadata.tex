% Metadata Version: 3.5.2

% Tone/context (e.g., formal, informal, business)
\def\tone{informal}  % Set via config or database

% LOGO, letterhead, signature images
\def\logo{\linebreak \includegraphics[height=2.5em]{assets/logo.png}} % Path to logo
\def\signatureimage{\vspace*{1.5em}\includegraphics[height=3.5em]{assets/signature.png}}% Path to signature image
\definecolor{companyblue}{RGB}{0,80,80}
\definecolor{companygray}{RGB}{45,58,58}

% Date override (defaults to \today if empty)
\def\customdate{}  % e.g., "21 February 2026"
\ifthenelse{\equal{\customdate}{}}{
  \date{\today}
}{
  \date{\customdate}
}

% Letterhead/header setup (optional, transparent if off) - define path, then update \fancyhead
\def\useletterhead{yes}  % "yes" or "no"; set via config
\def\letterheadpath{assets/noletterhead.png}  % Default to transparent
\ifthenelse{\equal{\useletterhead}{yes}}{
  \def\letterheadpath{assets/letterhead.png}
}{}
\fancyhead[C]{\includegraphics[height=4.0em,width=\textwidth,keepaspectratio]{\letterheadpath}}  % Update here; applies to current/next pages
%\fancyhead[C]{Test Header}


% Sender details
\def\sendername{Dr. Joe Bloggs M.D.}
\def\senderfirstname{Joe}
\def\senderlastname{Bloggs}
\def\sendertitle{Dr.}
\def\sendersuffix{M.D.}
\address{\textcolor{companyblue}{\sendername}\\
\textcolor{companyblue}{City}\\
\textcolor{companyblue}{Postcode}\\
\textcolor{companygray}{Mobile: +123 456 7890}\\
\textcolor{companygray}{Tel: +123 987 6543}\\
\textcolor{companygray}{Email: joe@example.com}}
\signature{\sendername}
\telephone{+44 123 456789}

% Recipient details (deconstruct raw data like "Bloggs, Joe")
\def\recipientcompany{Dept.of Social Services}
\def\recipienttitle{Ms.}
\def\recipienttitleshort{Ms.}
\def\recipientfirstname{Jane}
\def\recipientlastname{Doe}
\def\recipientsuffix{}
\def\recipientrawname{Doe, Jane}  % From database
\def\recipientaddress{\recipientcompany\ \\ \recipienttitle\ \recipientfirstname\ \recipientlastname\ \recipientsuffix\\456 Recipient Road\\Big Town \linebreak  \linebreak }


% Construct salutation based on tone
\ifthenelse{\equal{\tone}{formal}}{
  \def\salutation{Dear \recipienttitleshort\ \recipientlastname,}
}{
  \ifthenelse{\equal{\tone}{informal}}{
    \def\salutation{Dear \recipientfirstname,}
  }{
    \def\salutation{Dear Sir or Madam,}  % Default
  }
}

% Closing based on tone (phrase only; name handled in signature)
\ifthenelse{\equal{\tone}{formal}}{
  \def\closingphrase{Yours sincerely,}
}{
  \def\closingphrase{faithfully yours,}
}

% Redefine closing for left alignment (no indent, no right rag, fixed space)
\makeatletter
\long\def\closing#1{\par\nobreak\vspace{\parskip}%
  \stopletter%
  \noindent #1\par\nobreak%
  \vspace*{1em}%   % orginal: \vspace*{1em}%
  \noindent \fromsig \par}
\makeatother

% Redefine opening to remove \thispagestyle override (prevents empty/firstpage reset)
\makeatletter
\renewcommand*\opening[1]{\ifx\@empty\fromaddress
 % {\raggedleft\@date\par}%
  \else  % home address
    {\raggedleft\begin{tabular}{l@{}}\ignorespaces
      \fromaddress \\*[2\parskip]%
      \end{tabular}\par}%
  \fi
  \vspace*{-0.5cm}%    \vspace*{0.5cm}% 
  {\raggedright \toname \\ \toaddress \par}%
  {\raggedleft  \textcolor{companygray}{\@date}\par} % Date here, after recipient
  \vspace{2\parskip}%
  #1\par\nobreak}
\makeatother

% Signature setup (includes optional image, above name, no extra space)
\def\usesignature{yes}  % "yes" or "no"; set via config
\ifthenelse{\equal{\usesignature}{yes}}{
  \signature{\signatureimage\\ \sendername \\ \logo}
}{
  \signature{\vspace*{1em}\\ \sendername\\ \logo}
}

% Page number toggle for multipage
\def\multipage{no}  % "yes" or "no"; manual set
\ifthenelse{\equal{\multipage}{yes}}{
  \pagestyle{plain}
}{
  \pagestyle{empty}
}

% Custom subject/reference (no built-in; define and use \subjectline in content)
\def\subject{Regarding Our Business Proposal}  % Set via config/database
\newcommand{\subjectline}{\vspace{1em}\textbf{Subject: \subject}\par\vspace{1em}}  % Bold, left; or center with \centering
